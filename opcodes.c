#include "asm.h"
#include <string.h>
#include <stdio.h>

const opentry optable[]= {
  {"ADC", 0, {0,0,0x69,0x65,0x75,0,0x6D,0x7D,0x79,0,0x61,0x71}},
  {"AND", 0, {0,0,0x29,0x25,0x35,0,0x2D,0x3D,0x39,0,0x21,0x31}},
  {"ASL", 0, {0,0x0A,0,0x06,0x16,0,0x0E,0x1E,0,0,0,0}},
  {"BBR",20, {0,0,0,0,0,0,0x0F,0,0,0,0,0}},
  {"BBS",20, {0,0,0,0,0,0,0x8F,0,0,0,0,0}},
  {"BCC", 2, {0,0,0,0,0,0,0x90,0,0,0,0,0}},
  {"BCS", 2, {0,0,0,0,0,0,0xB0,0,0,0,0,0}},
  {"BEQ", 2, {0,0,0,0,0,0,0xF0,0,0,0,0,0}},
  {"BIT", 0, {0,0,0x20,0x24,0x34,0,0x2C,0x3C,0,0,0,0}},
  {"BMI", 2, {0,0,0,0,0,0,0x30,0,0,0,0,0}},
  {"BNE", 2, {0,0,0,0,0,0,0xD0,0,0,0,0,0}},
  {"BPL", 2, {0,0,0,0,0,0,0x10,0,0,0,0,0}},
  {"BRA",10, {0,0,0,0,0,0,0x80,0,0,0,0,0}},
  {"BRK", 1, {0,0,0,0,0,0,0,0,0,0,0,0}},
  {"BVC", 2, {0,0,0,0,0,0,0x50,0,0,0,0,0}},
  {"BVS", 2, {0,0,0,0,0,0,0x70,0,0,0,0,0}},
  {"CLC", 0, {0x18,0,0,0,0,0,0,0,0,0,0,0}},
  {"CLD", 0, {0xD8,0,0,0,0,0,0,0,0,0,0,0}},
  {"CLI", 0, {0x58,0,0,0,0,0,0,0,0,0,0,0}},
  {"CLV", 0, {0xB8,0,0,0,0,0,0,0,0,0,0,0}},
  {"CMP", 0, {0,0,0xC9,0xC5,0xD5,0,0xCD,0xDD,0xD9,0,0xC1,0xD1}},
  {"CPX", 0, {0,0,0xE0,0xE4,0,0,0xEC,0,0,0,0,0}},
  {"CPY", 0, {0,0,0xC0,0xC4,0,0,0xCC,0,0,0,0,0}},
  {"DEC", 0, {0,0x3A,0,0xC6,0xD6,0,0xCE,0xDE,0,0,0,0}},
  {"DEX", 0, {0xCA,0,0,0,0,0,0,0,0,0,0,0}},
  {"DEY", 0, {0x88,0,0,0,0,0,0,0,0,0,0,0}},
  {"EOR", 0, {0,0,0x49,0x45,0x55,0,0x4D,0x5D,0x59,0,0x41,0x51}},
  {"INC", 0, {0,0x1A,0,0xE6,0xF6,0,0xEE,0xFE,0,0,0,0}},
  {"INX", 0, {0xE8,0,0,0,0,0,0,0,0,0,0,0}},
  {"INY", 0, {0xC8,0,0,0,0,0,0,0,0,0,0,0}},
  {"JMP", 0, {0,0,0,0,0,0,0x4C,0,0,0x6C,0,0}},
  {"JSR", 0, {0,0,0,0,0,0,0x20,0,0,0,0,0}},
  {"LDA", 0, {0,0,0xA9,0xA5,0xB5,0,0xAD,0xBD,0xB9,0,0xA1,0xB1}},
  {"LDX", 0, {0,0,0xA2,0xA6,0,0xB6,0xAE,0,0xBE,0,0,0}},
  {"LDY", 0, {0,0,0xA0,0xA4,0xB4,0,0xAC,0xBC,0,0,0,0}},
  {"LSR", 0, {0,0x4A,0,0x46,0x56,0,0x4E,0x5E,0,0,0,0}},
  {"NOP", 0, {0xEA,0,0,0,0,0,0,0,0,0,0,0}},
  {"ORA", 0, {0,0,0x09,0x05,0x15,0,0x0D,0x1D,0x19,0,0x01,0x11}},
  {"PHA", 0, {0x48,0,0,0,0,0,0,0,0,0,0,0}},
  {"PHP", 0, {0x08,0,0,0,0,0,0,0,0,0,0,0}},
  {"PHX", 8, {0xDA,0,0,0,0,0,0,0,0,0,0,0}},
  {"PHY", 8, {0x5A,0,0,0,0,0,0,0,0,0,0,0}},
  {"PLA", 0, {0x68,0,0,0,0,0,0,0,0,0,0,0}},
  {"PLP", 0, {0x28,0,0,0,0,0,0,0,0,0,0,0}},
  {"PLX", 8, {0xFA,0,0,0,0,0,0,0,0,0,0,0}},
  {"PLY", 8, {0x7A,0,0,0,0,0,0,0,0,0,0,0}},
  {"RMB",20, {0,0,0,0,0,0,0x07,0,0,0,0,0}},
  {"ROL", 0, {0,0x2A,0,0x26,0x36,0,0x2E,0x3E,0,0,0,0}},
  {"ROR", 0, {0,0x6A,0,0x66,0x76,0,0x6E,0x7E,0,0,0,0}},
  {"RTI", 0, {0x40,0,0,0,0,0,0,0,0,0,0,0}},
  {"RTS", 0, {0x60,0,0,0,0,0,0,0,0,0,0,0}},
  {"SBC", 0, {0,0,0xE9,0xE5,0xF5,0,0xED,0xFD,0xF9,0,0xE1,0xF1}},
  {"SMB",20, {0,0,0,0,0,0,0x87,0,0,0,0,0}},
  {"SEC", 0, {0x38,0,0,0,0,0,0,0,0,0,0,0}},
  {"SED", 0, {0xF8,0,0,0,0,0,0,0,0,0,0,0}},
  {"SEI", 0, {0x78,0,0,0,0,0,0,0,0,0,0,0}},
  {"STA", 0, {0,0,0,0x85,0x95,0,0x8D,0x9D,0x99,0,0x81,0x91}},
  {"STX", 0, {0,0,0,0x86,0,0x96,0x8E,0,0,0,0,0}},
  {"STY", 0, {0,0,0,0x84,0,0x94,0x8C,0,0,0,0,0}},
  {"STZ", 8, {0,0,0,0x94,0xA4,0,0x9C,0xAC,0,0,0,0}},
  {"TAX", 0, {0xAA,0,0,0,0,0,0,0,0,0,0,0}},
  {"TAY", 0, {0xA8,0,0,0,0,0,0,0,0,0,0,0}},
  {"TRB", 8, {0,0,0,0x14,0,0,0x1C,0,0,0,0,0}},
  {"TSB", 8, {0,0,0,0x04,0,0,0x0C,0,0,0,0,0}},
  {"TSX", 0, {0xBA,0,0,0,0,0,0,0,0,0,0,0}},
  {"TXA", 0, {0x8A,0,0,0,0,0,0,0,0,0,0,0}},
  {"TXS", 0, {0x9A,0,0,0,0,0,0,0,0,0,0,0}},
  {"TYA", 0, {0x98,0,0,0,0,0,0,0,0,0,0,0}}
};

#define optabsize 68

int lookupop(char *name, int *flags) {
  int i, lo, hi;
  int found, diff;

  found=-1;
  lo=0; hi=optabsize-1;
  while(hi>=lo) {
    i=(hi+lo)/2;
    diff=strcmp(optable[i].opname, name);
    if(diff==0) {
      found=i;
      *flags=optable[i].flags;
      break;
    } else if(diff > 0)
      hi=i-1;
    else
      lo=i+1;
  }
  return(found);
}

int lookupadr(char *name, int amode) {
  int i, lo, hi;
  int found, diff;

  found=0;
  lo=0; hi=optabsize-1;
  while(hi>=lo) {
    i=lo+(hi-lo)/2;
    diff=strcmp(optable[i].opname, name);
    if(diff==0) {
      found=optable[i].opcodes[amode];
      break;
    } else if(diff > 0)
      hi=i-1;
    else
      lo=i+1;
  }
  return(found);
}
